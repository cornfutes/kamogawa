{{define "page"}}
<h2>GAE Resource Tree</h2>

{{if .Unauthorized}}
<p>
  You've not authorized us for GCP access. <a href="authorization">Securely grant access.</a>
</p>
{{else if .MissingScopes}}
<p>
  The following OAuth2 Scopes are needed but not yet granted:

<ul>
  <li>https://www.googleapis.com/auth/cloud-platform.read-only
</ul>

<a href="authorization">Securely grant access</a>
( note: we applied principle of least privilege in the demo account. initially and, by default, only read scopes
requested.
write scopes ( due to lazy API practices on GCP's part ) are on opt-in basis.

</p>
{{else}}
<span style="font-style: italic;">Uncached / real-time query took 237ms involving ( {{.APICallCount}} ) API
  calls.</span>
<p>
  Assets from <span style="font-family: monospace">{{.Email}}</span>
</p>
<ul>{{.AssetLines}}</ul>

<h2 class="🍜">Update Instance Cache</h2>
<p>
  The full-graph traversal / cache invalidation runs on schedule.
</p>
<ul style="font-style: italic;">
  <li>Last indexing occured: {{.LastRunTime}} ago. ( triggered by scheduler ) </li>
  <li>Next indexing scheduled in: {{.NextRunTime}}.
    <a href="/plans" class="link_with_arrow">Perform ad-hoc run immediately</a>
  </li>
  <li>Indexing schedule every 24 hours.
    <a href="/plans" class="link_with_arrow">Increase this limit with Premium</a>
  </li>
</ul>
<p>
  You can manually refresh the cache for individual resources for free.
</p>

<button><a href="gae?r=true">Refresh Instances</a></button>
<br />
<br />

{{end}}

{{end}}